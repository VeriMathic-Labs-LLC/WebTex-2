<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebTeX Extension Isolation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f0f8ff;
            color: #333;
        }
        
        /* Test styles that should NOT be affected by extension */
        .original-styles {
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            color: white;
            font-weight: bold;
        }
        
        .test-box {
            background: #fff;
            border: 2px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        * {
            /* This should remain - extension shouldn't override with normalize */
            box-sizing: content-box !important;
        }
        
        h1, h2, h3 {
            /* These margins should remain intact */
            margin: 25px 0 15px 0;
            text-decoration: underline;
        }
        
        .custom-button {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        
        .custom-button:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <h1>Extension Isolation Test</h1>
    
    <div class="original-styles">
        ✅ This styled box should remain exactly the same whether WebTeX is enabled or disabled.
        The gradient background, padding, and colors should never change.
    </div>
    
    <div class="test-box">
        <h2>Website Styling Test</h2>
        <p>This paragraph should maintain its styling. Box model should be content-box, not border-box.</p>
        <button class="custom-button">Custom Button</button>
        <p>All margins, padding, and colors should remain unchanged when extension toggles.</p>
    </div>
    
    <div class="test-box">
        <h2>Math Rendering Test</h2>
        <p>When enabled, this math should render: $E = mc^2$ and $$\int_0^\pi \sin(x) dx = 2$$</p>
        <p>When disabled, it should show as plain text and all styles should be removed.</p>
        <p>Nuclear notation: $\text{_88^226 Ra} \to \text{_86^222 Rn} + \text{_2^4 He}$</p>
    </div>
    
    <div class="test-box">
        <h2>Extension Impact Check</h2>
        <ul>
            <li>✅ Original website colors preserved</li>
            <li>✅ Original margins and padding intact</li>
            <li>✅ Custom button styling unchanged</li>
            <li>✅ Box model (content-box) not overridden</li>
            <li>✅ No global CSS normalization applied</li>
        </ul>
    </div>
    
    <div class="test-box">
        <h3>Toggle Instructions</h3>
        <p>1. Open WebTeX extension popup</p>
        <p>2. Toggle the extension ON/OFF</p>
        <p>3. Verify that ONLY the math expressions change</p>
        <p>4. All other styling should remain identical</p>
        <p>5. Check browser DevTools for any injected styles when disabled</p>
    </div>
    
    <script>
        // Test that extension doesn't interfere with page JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page JavaScript working normally');
            
            // Monitor for any unexpected style changes
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeName === 'STYLE' && node.id && node.id.startsWith('webtex-')) {
                                console.log('WebTeX style injected:', node.id);
                            }
                        });
                        mutation.removedNodes.forEach(function(node) {
                            if (node.nodeName === 'STYLE' && node.id && node.id.startsWith('webtex-')) {
                                console.log('WebTeX style removed:', node.id);
                            }
                        });
                    }
                });
            });
            
            observer.observe(document.head, { childList: true });
        });
        
        // Test function to verify styles
        function checkStyles() {
            const testBox = document.querySelector('.test-box');
            const computedStyle = window.getComputedStyle(testBox);
            console.log('Box model:', computedStyle.boxSizing);
            console.log('Background:', computedStyle.backgroundColor);
            console.log('Border:', computedStyle.border);
            
            // Count WebTeX elements
            const webTexElements = document.querySelectorAll('[class*="webtex"]');
            console.log('WebTeX elements found:', webTexElements.length);
            
            // Check for injected stylesheets
            const webTexStyles = document.querySelectorAll('style[id*="webtex"]');
            console.log('WebTeX stylesheets:', webTexStyles.length);
        }
        
        // Run check every 2 seconds
        setInterval(checkStyles, 2000);
    </script>
</body>
</html>