<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebTeX Fixes Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f5f5f5;
            color: #333;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        .math-example {
            background: #f9f9f9;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #007cba;
        }
        .description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .expected {
            background: #e8f5e8;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #4caf50;
        }
        .warning {
            background: #fff3cd;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        .console-log {
            background: #f8f9fa;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <h1>WebTeX Fixes Test</h1>
    <p>This page tests the fixes for the reported issues:</p>
    <ul>
        <li>Toggle button functionality</li>
        <li>Parsing on all sites</li>
        <li>Math equation color contrast</li>
    </ul>

    <div class="test-section">
        <h3>Toggle Button Test</h3>
        <div class="description">Test the extension popup toggle button functionality.</div>
        
        <div class="warning">
            <strong>Instructions:</strong>
            <ol>
                <li>Click the WebTeX extension icon in your browser toolbar</li>
                <li>The popup should show the current domain and toggle status</li>
                <li>Click the toggle switch to enable/disable WebTeX on this site</li>
                <li>Check the console for initialization and toggle messages</li>
            </ol>
        </div>
        
        <div class="console-log" id="console-output">
            <strong>Expected Console Messages:</strong><br>
            • "WebTeX: Initializing on [domain] enabled: [true/false] allowed domains: [...]"<br>
            • "WebTeX: Domain update received, new enabled state: [true/false]"<br>
            • "WebTeX: Message sent to content script, response: {success: true}"
        </div>
    </div>

    <div class="test-section">
        <h3>Parsing Test</h3>
        <div class="description">Test that LaTeX parsing works correctly on this site.</div>
        
        <div class="math-example">
            <strong>Basic math expressions:</strong><br>
            The quadratic formula is $x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$<br>
            The Pythagorean theorem: $$a^2 + b^2 = c^2$$<br>
            Greek letters: $\alpha + \beta = \gamma$
        </div>
        
        <div class="math-example">
            <strong>Fractions (font error test):</strong><br>
            $\frac{1}{2}$ - One half<br>
            $\frac{1}{3}$ - One third<br>
            $\frac{2}{3}$ - Two thirds
        </div>
        
        <div class="expected">
            <strong>Expected:</strong> All math expressions should render properly with good contrast.
        </div>
    </div>

    <div class="test-section">
        <h3>Color Contrast Test</h3>
        <div class="description">Test that math equations have proper contrast against the background.</div>
        
        <div class="math-example" style="background-color: #e0e0e0;">
            <strong>Light background test:</strong><br>
            $E = mc^2$ should be clearly visible<br>
            $$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$
        </div>
        
        <div class="math-example" style="background-color: #333; color: white;">
            <strong>Dark background test:</strong><br>
            $E = mc^2$ should be clearly visible<br>
            $$\int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi}$$
        </div>
        
        <div class="expected">
            <strong>Expected:</strong> Math equations should be clearly visible with good contrast on both light and dark backgrounds.
        </div>
    </div>

    <div class="test-section">
        <h3>Mixed Content Test</h3>
        <div class="description">Test mixed content with different types of math expressions.</div>
        
        <div class="math-example">
            <strong>Mixed expressions:</strong><br>
            The probability is $\frac{1}{2}$ or 50%.<br>
            For nuclear decay: $\text{_Z^A N} \to \text{_Z^A N} + \gamma$<br>
            The area is $A = \pi r^2$ where $\pi \approx 3.14159$<br>
            Complex fraction: $$\frac{\frac{1}{2} + \frac{1}{3}}{\frac{1}{4} + \frac{1}{5}} = \frac{50}{27}$$
        </div>
        
        <div class="expected">
            <strong>Expected:</strong> All expressions should render properly with consistent styling.
        </div>
    </div>

    <div class="test-section">
        <h3>Console Output Check</h3>
        <div class="description">Check the browser console for these messages:</div>
        <div class="console-log">
            <strong>Initialization:</strong><br>
            • "WebTeX: Initializing on [domain] enabled: [true/false] allowed domains: [...]"<br>
            • "Custom LaTeX renderer is ready (fallback)"<br><br>
            
            <strong>Toggle Actions:</strong><br>
            • "WebTeX: Domain update received, new enabled state: [true/false]"<br>
            • "WebTeX: Message sent to content script, response: {success: true}"<br><br>
            
            <strong>Rendering:</strong><br>
            • "Fraction content detected, will use custom renderer to avoid font issues" (if fractions present)<br>
            • "Using custom renderer for nuclear physics content" (if nuclear content present)<br>
            • No "No character metrics" errors<br>
            • No KaTeX font-related error messages
        </div>
    </div>

    <script>
        // Add some dynamic content to test SPA-like behavior
        setTimeout(() => {
            const newSection = document.createElement('div');
            newSection.className = 'test-section';
            newSection.innerHTML = `
                <h3>Dynamically Added Content</h3>
                <div class="description">This section was added dynamically to test SPA navigation detection.</div>
                <div class="math-example">
                    <strong>Dynamic math:</strong><br>
                    $\frac{1}{2} + \frac{1}{3} = \frac{5}{6}$<br>
                    The derivative of $f(x) = x^3$ is $f'(x) = 3x^2$
                </div>
            `;
            document.body.appendChild(newSection);
        }, 2000);
    </script>
</body>
</html> 